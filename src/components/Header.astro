---
interface Props {
	currentPage?: string;
}

const { currentPage = 'home' } = Astro.props;

const navItems = [
	{ label: 'Configurateur', href: '/configurateur', id: 'configurateur' },
	{ label: 'Nos mod√®les', href: '/modeles', id: 'modeles' },
	{ label: 'L\'atelier', href: '/atelier', id: 'atelier' },
	{ label: 'Contact', href: '/contact', id: 'contact' },
];

// R√©cup√©rer l'utilisateur depuis les locals (middleware)
const user = Astro.locals.user;
---

<header class="bg-beige-lin h-[100px] px-20 flex items-center justify-between shadow-sm sticky top-0 z-50">
	<!-- Logo -->
	<div class="flex flex-col">
		<a href="/" class="logo no-underline">TaVue.</a>
		<span class="text-[10px] tracking-[2px] uppercase text-gris-taupe font-medium">Fabrication Fran√ßaise</span>
	</div>
	
	<!-- Navigation -->
	<nav class="flex items-center gap-8">
		{navItems.map(item => (
			<a 
				href={item.href}
				class={`text-[15px] font-medium text-bleu-marine hover:text-brun-clair transition-colors duration-300 ${currentPage === item.id ? 'border-b-2 border-brun-clair' : ''}`}
			>
				{item.label}
			</a>
		))}
	</nav>
	
	<!-- CTA Button / User Menu -->
	{user ? (
		<div class="flex items-center gap-4">
			<div class="flex flex-col items-end">
				<span class="text-sm font-medium text-bleu-marine">üëã {user.name}</span>
				<span class="text-xs text-gris-taupe">{user.email}</span>
			</div>
			<button id="logout-btn" class="px-4 py-2 border-2 border-bleu-marine text-bleu-marine rounded-lg hover:bg-bleu-marine hover:text-white transition-all">
				D√©connexion
			</button>
		</div>
	) : (
		<a href="/compte" class="btn-primary">
			Mon compte
		</a>
	)}
</header>

{user && (
	<script>
		document.getElementById('logout-btn')?.addEventListener('click', async () => {
			if (!confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) return;
			
			try {
				const res = await fetch('/api/logout', {
					method: 'POST',
					credentials: 'include'
				});
				
				if (res.ok) {
					localStorage.removeItem('user');
					window.location.href = '/';
				} else {
					alert('‚ùå Erreur de d√©connexion');
				}
			} catch (error) {
				console.error('Erreur logout:', error);
				alert('‚ùå Erreur r√©seau');
			}
		});
	</script>
)}