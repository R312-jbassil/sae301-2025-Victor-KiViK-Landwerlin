---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import pb from '../utils/pb';

const user = Astro.locals.user;

let creations = [];
if (user && user.id) {
    try {
        creations = await pb.collection('lunettes').getFullList({
            sort: '-created',
            filter: `user = "${user.id}"`
        });
    } catch (error) {
        console.error('Erreur:', error);
    }
}
---

<Layout>
	<Header currentPage="modeles" />
	
	<main class="p-20 bg-blanc-casse min-h-[calc(100vh-100px)]">
		<div class="flex justify-between items-center mb-12">
			<div>
				<h1 class="text-4xl font-semibold text-bleu-marine mb-2">Mes cr√©ations</h1>
				<p class="text-gris-taupe">Retrouve toutes tes paires de lunettes personnalis√©es</p>
			</div>
			<a href="/configurateur" class="btn-primary">
				Nouvelle cr√©ation
			</a>
		</div>
		
		{creations.length > 0 ? (
			<div class="grid grid-cols-3 gap-8">
				{creations.map(creation => (
					<a href={`/produit?id=${creation.id}`} class="card p-6 hover:-translate-y-2 hover:shadow-2xl transition-all duration-300 group">
						<div class="bg-blanc-casse p-8 rounded-xl mb-4 h-[250px] flex items-center justify-center"
							set:html={creation.svg_data}
						>
						</div>
						
						<h3 class="text-xl font-semibold text-bleu-marine mb-2">{creation.nom}</h3>
						<p class="text-sm text-gris-taupe mb-4">{creation.materiau}</p>
						
						<div class="flex justify-between items-center pt-4 border-t border-beige-lin">
							<span class="text-lg font-semibold text-brun-clair">{creation.prix} ‚Ç¨</span>
							<button class="text-bleu-marine hover:text-brun-clair transition-colors">
								Voir ‚Üí
							</button>
						</div>
					</a>
				))}
			</div>
		) : (
			<div class="text-center py-20">
				<div class="text-6xl mb-4">üëì</div>
				<h2 class="text-2xl font-semibold text-bleu-marine mb-3">Aucune cr√©ation pour le moment</h2>
				<p class="text-gris-taupe mb-8">Commence par cr√©er ta premi√®re paire de lunettes personnalis√©e</p>
				<a href="/configurateur" class="btn-primary inline-block">
					Cr√©er mes lunettes
				</a>
			</div>
		)}
	</main>
</Layout>